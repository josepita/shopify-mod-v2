{% extends "base.html" %}
{% block content %}
<div class="card p-3 mb-3">
  <div class="d-flex justify-content-between align-items-center">
    <h3 class="h5 m-0">Explorador de catálogos guardados</h3>
    <a class="btn btn-sm btn-outline-secondary" href="/catalog/compare">Ir a comparar</a>
  </div>
  <div class="text-muted">Listados por fecha de snapshot (desc). Se calculan métricas básicas desde la base de datos de snapshots.</div>
  <div class="table-responsive mt-2">
    <table class="table table-sm table-striped align-middle">
      <thead>
        <tr>
          <th>Fecha snapshot</th>
          <th>Artículos</th>
          <th>% sin precio</th>
          <th>% sin stock</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for s in snapshots %}
        <tr>
          <td>{{ s.snapshot_date }}</td>
          <td>{{ s.rows }}</td>
          <td>{{ s.pct_zero_price }}%</td>
          <td>{{ s.pct_zero_stock }}%</td>
          <td>
            <a class="btn btn-sm btn-outline-primary" href="/catalog/compare?a={{ s.snapshot_date }}">Usar como A</a>
            <a class="btn btn-sm btn-outline-secondary" href="/catalog/compare?b={{ s.snapshot_date }}">Usar como B</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if files and files|length > 0 %}
<div class="card p-3 mb-3">
  <h4 class="h6">Archivos almacenados en disco</h4>
  <div class="text-muted">Se muestran copias CSV guardadas en <code>data/csv_archive</code> como respaldo (si no hay snapshot de BD).</div>
  <div class="table-responsive mt-2">
    <table class="table table-sm table-striped align-middle">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Fecha</th>
          <th>Artículos</th>
          <th>% sin precio</th>
          <th>% sin stock</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for f in files %}
        <tr>
          <td>{{ f.name }}</td>
          <td>{{ f.modified }}</td>
          <td>{{ f.rows }}</td>
          <td>{{ f.pct_zero_price }}%</td>
          <td>{{ f.pct_zero_stock }}%</td>
          <td>
            <a class="btn btn-sm btn-outline-secondary" href="/catalog/compare">Comparar</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}
{% endblock %}
